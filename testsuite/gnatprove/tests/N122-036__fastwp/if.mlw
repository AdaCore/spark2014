module If
  use import int.Int
  use import ref.Ref

(* Valid *)
  let test1 (x : ref int)
    requires {true }
    ensures { !x = 0 }
    =
    if !x <> 0 then
      x := 0
    else ()

(* Unknown *)
  let test2 (x : ref int)
    requires {true }
    ensures { !x = 0 }
    =
    if !x > 10 then
      x := 0
    else ()

(* Valid *)
  let test3 (x : ref int)
    requires { !x >= 15 }
    ensures { !x = 0 }
    =
    if !x > 10 then
      x := 0
    else ()

(* Valid *)
  let test4 (x : ref int)
    requires {true }
    ensures { if old !x > 15 then !x = old !x + 1 else !x = old !x }
    =
    if !x > 15 then
      x := !x + 1
    else
      ()

(* Unknown *)
  let test5 (x : ref int)
    requires {true }
    ensures { !x = old !x }
    =
    if !x > 15 then
      x := !x + 1
    else
      ()


  val x : ref int
  val garble_x (z : unit) : unit
    requires {true }
    writes { x }
    ensures {true }

(* Valid *)
  let test6 ()
    requires { !x <> 0 }
    ensures { !x = old !x }
    =
    if !x = 0 then
      garble_x ()
    else ()

(* Unknown *)
  let test7 ()
    requires {true }
    ensures { !x = old !x }
    =
    if !x = 0 then
      garble_x ()
    else ()
end
