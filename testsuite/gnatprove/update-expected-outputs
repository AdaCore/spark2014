#!/usr/bin/env python3

from e3.testsuite.result import TestStatus
from glob import glob
import os.path
import yaml


def update_baseline(testname, out):
    fn = os.path.join("tests", testname, "test.out")
    print("Update output " + fn)
    with open(fn, "w") as f:
        f.write(out)


for yaml_file in glob("out/new/*.yaml"):
    with open(yaml_file, "r") as f:
        result = yaml.safe_load(f)
    if result.status == TestStatus.FAIL:
        update_baseline(result.env['test_name'], result.out)
