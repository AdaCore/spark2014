#!/usr/bin/env python3

from e3.testsuite.report.index import ReportIndex
from e3.testsuite.result import TestStatus
import os.path


def update_baseline(testname, out):
    testdir = os.path.join("tests", testname)
    if not os.path.exists(testdir):
        testdir = os.path.join("internal", testname)
    if not os.path.exists(testdir):
        print("can't find test with name " + testname)
        exit(1)
    fn = os.path.join(testdir, "test.out")
    print("Update output " + fn)
    with open(fn, "w") as f:
        f.write(out)


index = ReportIndex.read("out/new")
for entry in index.entries.values():
    if entry.status == TestStatus.FAIL:
        result = entry.load()
        update_baseline(result.env['test_name'], result.out)
